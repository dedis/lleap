package ch.epfl.dedis.lleap;

import ch.epfl.dedis.lib.Roster;
import sun.security.rsa.RSAPrivateCrtKeyImpl;

import javax.xml.bind.DatatypeConverter;
import java.security.KeyFactory;
import java.security.NoSuchAlgorithmException;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.RSAPublicKeySpec;

/**
 * DEDISSkipchain represents the pre-configured skipchain on the dedis-servers. It holds the roster-definition,
 * the skipchain-id and the private/public keypair allowed to write to the skipchain.
 */
public class DEDISSkipchain {
    private static String rosterStr = "[[servers]]\n" +
            "  Address = \"tcp://lleap.dedis.ch:15002\"\n" +
            "  Suite = \"Ed25519\"\n" +
            "  Public = \"a863cf64422ab15f405369134cd057f99e2b40cb45afe7848dde11f34853f708\"\n" +
            "  Description = \"Conode_1\"\n" +
            "[[servers]]\n" +
            "  Address = \"tcp://lleap.dedis.ch:15004\"\n" +
            "  Suite = \"Ed25519\"\n" +
            "  Public = \"4706d99de05a58179ccc11ea3c452d9e44b43290de696f83f0fbc8ae26b6679a\"\n" +
            "  Description = \"Conode_2\"\n" +
            "[[servers]]\n" +
            "  Address = \"tcp://lleap.dedis.ch:15006\"\n" +
            "  Suite = \"Ed25519\"\n" +
            "  Public = \"4c4d5dd6fa750d5fb32f005b0a357a39d3886454d9fe63255a89ef0542f835d9\"\n" +
            "  Description = \"Conode_3\"\n";


    // roster is used to communicate with the cothority
    public static Roster roster = Roster.FromToml(rosterStr);
    // skipchainID is the pre-configured skipchain on the cothority. As it is a cryptographic hash,
    // it is secure to trust it as nobody should be able to forge a block with the same ID.
    public static byte[] skipchainID = DatatypeConverter.parseHexBinary("5da91cfa590947b11fa8f81c69319d26f9be7b7b890ed2707e09a5a9e2d6e3cd");

    /**
     * Returns the private key that can be used to sign key/value pairs when they are stored on the
     * skipchain.
     *
     * @return PrivateKey
     */
    public static PrivateKey getPrivate() {
        try {
            KeyFactory kf = KeyFactory.getInstance("RSA");
            return kf.generatePrivate(new PKCS8EncodedKeySpec(DatatypeConverter.parseHexBinary(DEDISSkipchain.privateKeyStr)));
        } catch (NoSuchAlgorithmException e) {
            throw new RuntimeException(e.getMessage());
        } catch (InvalidKeySpecException e) {
            throw new RuntimeException(e.getMessage());
        }
    }

    /**
     * Returns the public key that can be used to verify a key/value pair from the skipchain.
     *
     * @return PublicKey
     */
    public static PublicKey getPublic() {
        try {
            RSAPrivateCrtKeyImpl rsaPrivateKey = (RSAPrivateCrtKeyImpl) getPrivate();
            return KeyFactory.getInstance("RSA").generatePublic(new RSAPublicKeySpec(rsaPrivateKey.getModulus(), rsaPrivateKey.getPublicExponent()));
        } catch (NoSuchAlgorithmException e) {
            throw new RuntimeException(e.getMessage());
        } catch (InvalidKeySpecException e) {
            throw new RuntimeException(e.getMessage());
        }
    }

    // Created private key by the TestSkipchainRPC.setupKP method.
    private static String privateKeyStr = "30820941020100300D06092A864886F70D01010105000482092B308209270201000282020100809465D172D4CFBF244A9599E068E3942F40AD619B5CA8B326F13EF29FD7D20BC568838337D945D53C508F29628102EFB39765AB5959E789559178A55FA570CEEFCC9573CD72D6B7A70F9AD78D09DB30F5DF1366183C4F94533FD1562FB441B19705E6891BE17A628383078FAC237AD171E2BFF4885865FF635A31FAD9B09F55521A362EEAA1489B53DE24B0AD4BAFDD275608687493089A925E175FFAF81A1F01E278B4E53E5B4940DF495A348067906CD052B64BE8D09695442C1F5F541BAB9AEB7564DB54668F28EDADFDB21F513032C04927921E90E45F318C9BF776ACC584539410EBF06662B76ECBC8A98B2B379B86D6ABEEE50FE726C06529A8FBA84A359662DD089A21701B079B4F6182BABD289B3B17CE8B5BDC54FB0A2E3C89BDCDB0669E0FCDD26C2D0A82BDDC5732E3E9B90925FDB279487DCA47FF1F2CC184A454563D2BE26719422599A2039A341826788E72B7899834A75E17BEF5481993F909E48715E8F47C6E40F6C0357F1D0833709F4E68909A79A4C5CB703AE5353E78DE4F87FAD73ED306770B249E38DB1F6F5763C7C8321A00DBADD72893A7516067CD0D3FE83989566202DE1B58D2B462C72129E461A41ED69AD8AD3937EE70781392B4C5E16EA592288FCE0991D6038C182279A7E2C1F5C038C786128D84C79B510103105781047707B4243BC8F185979F7C31E54C14A05B080C2B8E600A0937EB02030100010282020053A93AFEA6EAD52997617829A11C5E4782DF6070CBF7E4447D28273F12C608836434F6AD205F9CD27BE626E0549980E19A46FDFE19AB27BDF2112F20DB34F84B8D37DE5E74E52DD45D3D08110C51C76EF9EBE5E15E0F8FF000A2DB806A95ACD0F26502755FD0BC22F153064E7340BA9F20ACDB1D2EC1E5CBE0474591E4A6C96568806994E9517BBEA5393B4241DFA7540C4E2C365AF3787BAA94D23CBF3D4331BDB62FB7F41938A8572F71B8E1C4529E644EC022A10DA0FAF9B05BCD25E7C2014C51BC169DA732FC1F33572C65037F7E0EE79231CF1F58435FB50BBA47AFCE06CE6CDB408F63E21A8523F030663089342B5BF6BDF438D2BA223AB917FC3D92679A84B30498875B26202CDF78BF68508509FFD75A6146EA5F86445A79C72B8D0F739907E16FD6C7DB36691889150852DA5A4B49FBF0DFBA6CFA2AA8DAF7696904AD826CF576E02B26B44F0DC15EB741E1FA03C2B856C05D5BF99A2C087757C7508234FF496BDE97F1500A03E8245792D064500CAAC6EA4C3A0C4B33C4D105E8C70815B5AB52156CC5A2CEE177B5CC5BC7FB5B1E7710A10D3938059BA7D639855D370A49AD9EB9F761337518F866B29795EC575D37F2ED752DE8BCDA0FCFA035204170FE8860CDBEA6A599B225DA831FFE0193D598FA3CC9933C7C861B241E7BB6D5FBC1986102C3B3F53478D8BC881A910A7DA2F6807D382D7ACBC3DC66E29A010282010100B92750FAA9605234B0A65CE12D2AC7BCDE10E3E611FBD07986BB404AE603FAAB37D6088EC9F0F1E1A8B43738F27F5EC608696D647570B523AF24F1A1BCEBACBF1AF2D78CC271D8D62A0CFB8D30F6CA8D81897C7A3E1F0B8796B59849B2DE2458F03332E11A629F0F03E7188838AEB7B7522F120175CFD1F0B0214967F3FDF014D61D5218EE20458BA2705D13CFBFF65B920FCFF47808C01CD856CE894D6DF4BBDFC1AF1056C1981848393E2F5152149708BD32A344086F9B1E319B1A90B1253369C5035B7BDAD10A5B1029CC490F217BF769055B72FFCF4A27D21D8F7345D518A342353771AAA82782011C55193CE6514DC9CDB73B0163730BA2A100BBA538810282010100B1C7654CFBFD1DC8DC830894E5C697F7E83F0C88A6AA0ED2C43C723C904DCEFABF7FB7A61E4861082A64922D04FF5B4A899A7F13F4CA2AEF74F063A76F7F32DC061060CEB59739A1F501D047B9AB923EECEC51B83FC325916B3489F3AA132304F627B55A17F1B179A7660EA8D1AD580993F29D0AAA6C990D8B93CB5AE14D6FAB188EA11F4DB895A6713542550525DC7579FA53486759D2E15BC5212180507E7E7A6D814E8F5ED99BD9FE09725D92C69723B0FE105B9CCB9EF3F7B14C3E40C72F204BCB105E503D22A5A7257FAA8ED8C1429FA168330ED83BD3FE9FE6B9BD0AA3CB4D166A29C56F1DB6C67A1C13EDECEFDF563AA410F0493FC24BA0BB217D9A6B0282010038591FCAF94B281982FD4E5CF52B04D894D89D1302BC192932F8BFCB4B8F4075652BCD34EF7E558EB092101053B4B1BA210B3CD08AF13F1F5A092B4466C36EB246584B833A15FDC0C7D165A90592C5F824C91BC9F427EC915A2B6FEA55F647278E0A76DC8CF420A62830E7856582BEC49ACD5A74794F42FC360E1B51F8AE7AA74CB665AAD2A59DA4AE4DF5F5B68F1C41A80509EBC3B01E0F694399DDAD63DE4C62FF85F0BA0676EC44E6AEE7259F8E469CD13F9CF27282CCB976AD567B5C7E0ED48CB1C5E0BEAA49B58708C1742697B12B8D99A4C82DD3FF24794CA7C0942B1331744FCFCCD6FC0FF1FFB688AB829E31763409584F2BD0014E34333D8EDDEC810282010042688A95BC57ABE59941B555F19342B74F6125EC71DD7A960EC9C99E880518B92009B46F70467740969D64E13E49A92F69C17590DDD31B40C1BCFE6CD040829E2001C437D32B7F52D973E8FAB207BE24955A1D98A6F0DDBAB98231B9FCA11366CA10C134BB570485BE1B68847576BC392FB3E427D4CBA64CA203FE659F5DCEC5E9F1758C7CFAE3A3FE0BF8104C50FD4E40D75A7EE464705AD06E0DD736D85AB822417F98FA0363644D8510C050E6001AFB312566B4E21849F336665B65B1CAF5F6A9795C4EEEC837860BAEFD4697FFAE099619B413C68ACDA67E29FB050CF1C987AAEF218F22FA43EE3FABE38B2A4864BE57B6A60CD1C57AF4B84D7D39A072AB02820100315C94674D8F7412EFFB9A58BBB5EF89732C2D23AC570B31D9D3511BF7966057EA9072FE4B954885CAAC33CCCAAD6AD8270F7FFACFBCF974DAF47F97F458B1266BE418D01145DA7A71CD0925FC08F06B864B0AC6932A28D675BDED35E2C355124770636419FD116C359884FC65A61C239353EFC3E80C2BD55C7AE2F1BE65509764836E23355E6D844ADB8B1BD867B6E9DF22AD1C97488E53CBA225626F01B907D82AE60431D3B45469CAE751F3D421EC1F9E999EC1BBF7E70DB076689896548BF6F25D6A5BC695D61D9E6F6629E54E36EEB10C60EF872AC51CF0185FB6075E7FD964DBE6C9A7C8121A4C2C6AC7314E1C0551F76673787B256A7FE5CEF0536B9B";
}
